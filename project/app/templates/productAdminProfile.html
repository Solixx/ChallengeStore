{% extends "base.html" %} 
{% block title %} Admin Panel | Challenge Store {% endblock %} 
{% block content %}
<div class="adminPanel">
  <div class="container">
    <h1 class="col12">Product</h1>
    <form  action="{% url 'productAdminEdit' product.id %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="col12">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" value="{{ product.name }}">
      </div>
      <div class="col12">
        <label for="price">Price</label>
        <input type="number" id="price" name="price" value="{{ product.price }}">
      </div>
      <div class="col12">
        <label for="stock">Stock</label>
        <input type="number" id="stock" name="stock" value="{{ product.stock }}">
      </div>
      <div class="col12">
        <label for="image">Image</label>
        <input type="file" id="image" name="image">
        
        <div style="display: flex; flex-direction: row; align-items: flex-end; gap: 20px; margin: 50px 0; widht: 100%; height: 300px">
          <img id="img-preview-50" src="{% if product.image %}{{ product.image.url }} {% endif %}" alt="Current Image" width="50px" style="height: 50px">
          <img id="img-preview-150" src="{% if product.image %}{{ product.image.url }} {% endif %}" alt="Current Image" width="150px" style="height: 150px">
          <img id="img-preview-300" src="{% if product.image %}{{ product.image.url }} {% endif %}" alt="Current Image" width="300px" style="height: 300px">
        </div>
        
      </div>
      <div class="col12">
        <label for="stock">Category</label>
        <select id="category" name="category" required value="product.category_id">
          {% for category in categories %}
            <option value="{{ category.id }}" {% if category.id == product.category_id %}selected{% endif %} {% if category.is_deleted %}disabled{% endif %}>{{ category.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col12">
        <button>
          Edit
        </button>
      </div>
    </form>
    <ul class="col12">
        <li>{{ product.name }} - ${{ product.price }}</li>
        <li>{{ product.stock }}</li>
        {% if product.image %}
          <li><img src="{{ product.image.url }}" alt="{{ product.name }}" /></li>
        {% endif %}
    </ul>
    <div class="col5">
      <a href="{% url 'productAdminRestore' product.id %}">
        <button>
          Restore
        </button>
      </a>
    </div>
    <div class="col2"></div>
    <div class="col5">
      <a href="{% url 'productAdminDelete' product.id %}">
        <button>
          Delete
        </button>
      </a>
    </div>
  </div>
</div>

<script>
  const imageInput = document.getElementById('image');
  imageInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        // Get the preview images by their IDs
        const img50 = document.getElementById('img-preview-50');
        const img150 = document.getElementById('img-preview-150');
        const img300 = document.getElementById('img-preview-300');
        
        // Update the image sources with the selected image's data URL
        const newSrc = e.target.result;
        if (img50) img50.src = newSrc;
        if (img150) img150.src = newSrc;
        if (img300) img300.src = newSrc;
      };
      
      // Read the selected image as a DataURL
      reader.readAsDataURL(file);
    }
  });
</script>
{% endblock %}
