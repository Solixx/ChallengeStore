{% extends "adminBase.html" %} 
{% block title %} Admin Panel | Challenge Store {% endblock %} 
{% block adminPageTitle %} LIST - PRODUCTS {% endblock %} 
{% block content %}
  <div class="container">
    <div class="col12">
      <form action="{% url 'adminListProducts' %}" method="POST">
        {% csrf_token %}
        <input type="search" name="search" placeholder="Search Products" value="{{ search }}" />
        <button type="submit">
          <h5>SEARCH</h5>
          {% comment %} <i class="fa fa-search"></i> {% endcomment %}
        </button>
      </form>
    </div>
    {% for product in products %}
        <div class="col4 colL4 colM6 colS3">
          <div class="adminProductBox {% if product.is_deleted %} adminProductBoxDisable {% endif %}">
            <a class="adminProductImg" href="{% url 'adminProductProfile' product.id %}">
              <img src="{{ product.image.url }}" alt="{{ product.name }}" />
            </a>
            <div class="adminProductContent">
              <div class="adminProductContentTop">
                <p class="smallP">{{ product.name }}</p>
                <p class="smallP">${{ product.price }}</p>
              </div>
              <div class="adminProductContentCategory">
                <form id="formCategory{{ product.id }}">
                  {% csrf_token %}
                  <select id="category{{product.id}}" name="category" required value="product.category_id" onChange="changeCategory({{product.id}})">
                    {% for category in categories %}
                      <option value="{{ category.id }}" {% if category.id == product.category_id %}selected{% endif %} {% if category.is_deleted %}disabled{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                  </select>
                </form>
              </div>
              <div class="adminProductContentButton">
                  {% if product.is_deleted %}
                    <a class="adminProductContentButtonActive" href="{% url 'adminProductRestore' product.id %}">
                      <button>
                        Restore
                      </button>
                    </a>
                  {% else %}
                    <a class="adminProductContentButtonDisable" href="{% url 'adminProductDelete' product.id %}">
                      <button>
                        Delete
                      </button>
                    </a>
                  {% endif %}
              </div>
            </div>
          </div>
          
        </div>
    {% endfor %}
  </div>

  <script>

    var changeCategory = (id) => {
      var form = document.getElementById('formCategory' + id);
      var formData = new FormData(form);
      
      fetch('http://127.0.0.1:8000/adminPanel/products/edit/'+id+'/', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    }

  </script>
{% endblock %}
